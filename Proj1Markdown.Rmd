---
title: "599_Project1"
author: "Corey"
date: "2023-02-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(skimr)
library(survival)# a change
library(survminer)
library(reReg)
library(KMsurv)
library(Ecdat)
```
This is a study of Natural vs Anthropogenic soils for 

```{r}
#data repo: https://github.com/bobbyjy/MyData

#load dataset into git repo
thePath="https://raw.githubusercontent.com/bobbyjy/MyData/main/"

#update with file name for project 1
Anth=read_csv(paste(thePath,"Anthropogenic.csv",sep="/"))

#load dataset into git repo
thePath="https://raw.githubusercontent.com/bobbyjy/MyData/main/"

#update with file name for project 1
Nat=read_csv(paste(thePath,"Natural.csv",sep="/"))

Nat
Nat %>% 
  filter(Temperature) %>% 
  group_by(Temperature) %>% 
  distinct()

Anth<-Anth %>% mutate(anthro=1)
Nat<-Nat %>% mutate(anthro=0)
coraldf <- combine(Anth,Nat)



df30 <- coraldf %>% filter(Sediment == 120)
df30

km.30=survfit(Surv(df30$Time,df30$Status)~df30$anthro) #defines your strata!

ggsurvplot(fit=km.30, data=df30,
           legend = "bottom", risk.table = F,conf.int=F,linetype = "strata") +
    labs(
        title="Survival Curve for Pharmaco Study",
        x="Time to Relapse)"
    ) 


```
```{r}


#groups are the sediment
#sediment values for sed valyues
Anth
km.censoring =survfit(Surv(Anth$Time,Anth$Status)~1)


ggsurvplot(fit=km.censoring, data=Anth,
           legend = "bottom", risk.table = F,conf.int=F,linetype = "strata") +
    labs(
        title="Survival Curve for Pharmaco Study",
        x="Time to Relapse)"
    ) 


Nat
km.censoring =survfit(Surv(Nat$Time,Nat$Status)~1)


km.strata=survfit(Surv(coraldf$Time,coraldf$Status)~coraldf$anthro + strata(coraldf$Sediment)) #defines your strata!

ggsurvplot(fit=km.strata, data=coraldf,
           legend = "bottom", risk.table = F,conf.int=F,linetype = "strata") +
    labs(
        title="Survival Curve for Pharmaco Study",
        x="Time to Relapse)"
    ) 

km.strata=survfit(Surv(coraldf$Time,coraldf$Status)~coraldf$anthro) #defines your strata!

ggsurvplot(fit=km.strata, data=coraldf,
           legend = "bottom", risk.table = F,conf.int=F,linetype = "strata") +
    labs(
        title="Survival Curve for Pharmaco Study",
        x="Time to Relapse)"
    ) 

survdiff(Surv(coraldf$Time,coraldf$Status)~coraldf$anthro + strata(coraldf$Sediment))


survdiff(Surv(coraldf$Time,coraldf$Status)~coraldf$anthro)


```
```{r}

km.strata=survfit(Surv(coraldf$Time,coraldf$Status)~coraldf$Sediment) #defines your strata!

ggsurvplot(fit=km.strata, data=coraldf,
           legend = "bottom", risk.table = F,conf.int=F, legend.title = "Sediment Concentration",) +
    labs(
        title="Survival Curve for Pharmaco Study",
        x="Weeks to Coral Death"
    ) 

survdiff(Surv(coraldf$Time,coraldf$Status)~coraldf$Sediment)

```

```{r}
#sample_n(ds,25) to take a random 25 samples from your data set

#Lollipop chart Example:
sample_ds %>%
  ggplot()+
  geom_segment(aes(x=0,y=fct_reorder(studentID, SATmin,.desc=TRUE), xend=SATmin, yend=fct_reorder(studentID, SATmin,.desc=TRUE)), color = "blue2", show.legend = FALSE)+
  geom_point(aes(x = SATmin, y = studentID, alpha = SATmin), size = 4, color = "blue2", show.legend = FALSE)+
  CoreyPlotTheme+
  labs(y = "Student ID", x = "Time (mins)", title = "Sample Student SAT Times")
 
```

```{r}
#some summary stats
ds %>% 
  summarise(mean=mean(sec_hours), min = min(sec_hours), quant25 = quantile(sec_hours, .25), median = quantile(sec_hours, .5), quant75 = quantile(sec_hours, .75), quant90 = quantile(sec_hours, .9), max = max(sec_hours), studentcount =n())
```

```{r}
#without censoring
km.nocensoring=survfit(Surv(scds1$time,rep(1,nrow(scds1)))~1)

#with censoring
km.censoring =survfit(Surv(scds1$time,scds1$status)~1)
summary(km.censoring)

#with groups
km = survfit(Surv(rats2.2$timeElapsed,rats2.2$status)~rats2.2$trt)

#with strata
ggsurvplot(fit=km.strata, data=ds,
           legend = "bottom", risk.table = F,conf.int=F,linetype = "strata") +
    labs(
        title="Survival Curve for Pharmaco Study",
        x="Time to Relapse)"
    ) 

#hypothesis test
survdiff(Surv(ds$ttr,ds$relapse)~ds$grp + strata(ds$ageGroup2))
```







